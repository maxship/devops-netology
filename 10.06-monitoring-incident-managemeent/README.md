# Домашнее задание к занятию "10.06. Инцидент-менеджмент"

## Задание 1

Составьте постмотрем, на основе реального сбоя системы Github в 2018 году.

Информация о сбое доступна [в виде краткой выжимки на русском языке](https://habr.com/ru/post/427301/) , а
также [развёрнуто на английском языке](https://github.blog/2018-10-30-oct21-post-incident-analysis/).

---

## Постмортрем

### Краткое описание инцидента

Деградация части сервисов, начавшаяся в 22:52 UTC 21 октября 2018, и длившаяся 24 часа 11 минут. В результате сбоя множество систем отображало устаревшие или поврежденные данные. Пользовательские данные при этом потеряны не были. 

### Предшествующие события

Проводившиеся плановые работы по замене отказавшего оптического оборудования 100G.

### Причина инцидента

Потеря соединения между сетевым хабом Восточного побережья США и главным ЦОД Восточного побережья. 

### Воздействие

Несмотря на то, что соединение было восстановлено через 43 секунды, эта потеря связи запустила цепочку событий, преведшую к более чем 24 ч деградации части сервисов, а именно, были затронуты метаданные веб-сайтов, хранящиеся в базах данных MySQL. 

### Обнаружение

В 22:54 UTC системы мониторинга начали генерировать алерты о множественных сбоях. 

### Реакция

В 23:02 UTC инженеры команды быстрого реагирования определили, что топология множества БД находится в непредвиденном состоянии. В 23:09 событию был присвоен желтый статус, что автоматически повысило ситуацию до уровня действующего инцидента. В 23:11 присоединился координатор инцидента и спустя 2 минуты присвоил красный статус. 

### Восстановление

В 00:05 начата разработка плана по разрешению несоответствия данных. В 00:41 начато восстановление бюкапа MySQL. В 06:51 восстановление данных Восточного побережья завершено и начато копирование новых данных с Западного побережья. 

### Таймлайн

22:52 21.10.2018 UTC - сбой соединения между ЦОД Восточного и Западного побережья США.  
22:54 21.10.2018 UTC - обнаружение сбоя.  
23:02 21.10.2018 UTC - определение причины сбоя, связанной с непредвиденным состоянием БД.  
23:09 21.10.2018 UTC - присвоение событию желтого статуса.  
23:11 21.10.2018 UTC - присвоение событию красного статуса.  
23:13 21.10.2018 UTC - привлечение дополнительных специалистов, детальное изучение ситуации.  
23:19 21.10.2018 UTC - принятие решения об остановке запущенных задач, пишущих метаданные.  
00:05 22.10.2018 UTC - разработка плана восстановления.  
00:41 22.10.2018 UTC - начат процесс восстановления кластеров из резервной копии.  
06:51 22.10.2018 UTC - окончание процесса восстановления, начало процесса репликации.  
07:46 22.10.2018 UTC - опубликовано сообщение с описанием сбоя в блоге.  
11:12 22.10.2018 UTC - окончание репликации кластеров.  
13:15 22.10.2018 UTC - выделены дополнительные MySQL реплики для уменьшения задержи репликации на чтение.  
16:24 22.10.2018 UTC - окончание синхронизации реплик. Статус сервисов сохранен на красном уровне, чтобы закончить процессы, накопившиеся за время сбоя.  
16:45 22.10.2018 UTC - подтверждение восстановления данных, статус сайта изменен на зеленый.  

### Последующие действия

- Были проанализированы бинарные логи восстановления MySQL для восстановления записей, не скопированных в ЦОД Западного побережья.
- Были внесены изменения в настройки оркестровщика.
- Ускорен переход на новый механизм отчетов статуса.
- За несколько недель до инцидента начата общекорпоративная инициатива по поддержке обслуживания трафика GitHub из нескольких ЦОД, поддержка резервирования N+1.
- Внедрение практики проверки негативных сценариев до того, как они произойдут.
